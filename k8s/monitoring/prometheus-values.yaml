serverFiles:
  prometheus.yml:
    scrape_configs:
      # User Service Scraping
      - job_name: 'user-service'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - default
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            action: keep
            regex: user-service
          - source_labels: [__meta_kubernetes_pod_ip]
            target_label: __address__
            replacement: $1:4000
          - source_labels: [__meta_kubernetes_pod_name]
            target_label: pod
          - source_labels: [__meta_kubernetes_namespace]
            target_label: namespace
      
      # Order Service Scraping
      - job_name: 'order-service'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - default
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            action: keep
            regex: order-service
          - source_labels: [__meta_kubernetes_pod_ip]
            target_label: __address__
            replacement: $1:5000
          - source_labels: [__meta_kubernetes_pod_name]
            target_label: pod
          - source_labels: [__meta_kubernetes_namespace]
            target_label: namespace

# Enable persistence for Prometheus data
server:
  persistentVolume:
    enabled: false  # Disable for KIND cluster
  
  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Disable components we don't need
alertmanager:
  enabled: false

pushgateway:
  enabled: false

nodeExporter:
  enabled: false

kubeStateMetrics:
  enabled: true
